<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ’¸ Add Expense - Finance Tracker</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="nav-container">
            <h1 class="logo">ğŸ’° Finance Tracker</h1>
            <ul class="nav-links">
                <li><a href="index.html">Dashboard</a></li>
                <li><a href="add-expense.html" class="active">Add Expense</a></li>
                <li><a href="add-income.html">Add Income</a></li>
                <li><a href="expenses.html">View Expenses</a></li>
                <li><a href="income.html">View Income</a></li>
                <li><a href="logs.html">Logs</a></li>
            </ul>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container">
        <div class="page-header">
            <h2></h2>ğŸ’¸ Add New Expense</h2>
            <p>Record your spending and track where your money goes</p>
        </div>

        <!-- Expense Form -->
        <div class="form-card">
            <form id="expenseForm" onsubmit="handleSubmit(event)">
                <div class="form-group">
                    <label for="amount">Amount (AED) *</label>
                    <input
                        type="number"
                        id="amount"
                        name="amount"
                        step="0.01"
                        min="0.01"
                        required
                        placeholder="Enter amount"
                        class="form-input">
                </div>

                <div class="form-group">
                    <label for="category">Category *</label>
                    <select id="category" name="category" required class="form-select">
                        <option value="">-- Select Category --</option>
                        <option value="FOOD">ğŸ” Food & Dining</option>
                        <option value="TRANSPORT">ğŸš— Transportation</option>
                        <option value="SHOPPING">ğŸ›ï¸ Shopping</option>
                        <option value="BILLS">ğŸ’¡ Bills & Utilities</option>
                        <option value="ENTERTAINMENT">ğŸ® Entertainment</option>
                        <option value="HEALTHCARE">ğŸ¥ Healthcare</option>
                        <option value="EDUCATION">ğŸ“š Education</option>
                        <option value="OTHER">ğŸ“ Other</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="description">Description *</label>
                    <textarea
                        id="description"
                        name="description"
                        rows="4"
                        required
                        placeholder="Enter expense description (e.g., Grocery shopping at supermarket)"
                        class="form-textarea"></textarea>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn-danger">
                        ğŸ’¾ Add Expense
                    </button>
                    <a href="expenses.html" class="btn btn-secondary">
                        âŒ Cancel
                    </a>
                </div>
            </form>

            <!-- Status Message -->
            <div id="statusMessage" class="status-message" style="display: none;"></div>
        </div>

        <!-- Quick Stats -->
        <div class="section-card">
            <h3>ğŸ“Š Quick Stats</h3>
            <div class="quick-stats">
                <div class="stat-item">
                    <span class="stat-label">Today's Expenses:</span>
                    <span class="stat-value" id="todayTotal">AED 0.00</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">This Month:</span>
                    <span class="stat-value" id="monthTotal">AED 0.00</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <p>Finance Tracker - OOP Project | BITS Pilani</p>
        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1); font-size: 0.9em;">
            <p style="margin: 5px 0;"><strong>OOP Group Project - 2025-2026</strong></p>
            <p style="margin: 5px 0;"><strong>Team Members:</strong></p>
            <p style="margin: 3px 0;">Harshwardhan Mohadikar - 2024ADPS0004U</p>
            <p style="margin: 3px 0;">Adhya Varshney - 2024A7PS0197U</p>
            <p style="margin: 3px 0;">Daksh Dawra - 2024A7PS0264U</p>
            <p style="margin: 3px 0;">Anirudh Jain - 2024A7PS0171U</p>
            <p style="margin: 3px 0;">Anish Malhotra - 2024A7PS0226U</p>
            <p style="margin: 3px 0;">Vardhaman Jain - 2024A7PS0229U</p>
        </div>
    </footer>

    <script>
        // CHANGE THIS to your Render.com backend URL
        const API_URL = 'http://localhost:8080';

        // Load statistics on page load
        window.addEventListener('DOMContentLoaded', function() {
            loadStatistics();
        });

        // Handle form submission
        function handleSubmit(event) {
            event.preventDefault();

            const form = document.getElementById('expenseForm');
            const formData = new FormData(form);
            const statusMessage = document.getElementById('statusMessage');

            // Show loading message
            statusMessage.style.display = 'block';
            statusMessage.className = 'status-message info-message';
            statusMessage.textContent = 'â³ Adding expense...';

            // Convert FormData to URL-encoded string
            const urlEncodedData = new URLSearchParams(formData).toString();

            fetch(API_URL + '/api/expenses', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: urlEncodedData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Show success message
                    statusMessage.className = 'status-message success-message';
                    statusMessage.textContent = 'âœ… Expense added successfully!';

                    // Reset form
                    form.reset();

                    // Reload statistics
                    loadStatistics();

                    // Redirect to expenses page after 2 seconds
                    setTimeout(() => {
                        window.location.href = 'expenses.html';
                    }, 2000);
                } else {
                    throw new Error(data.message || 'Failed to add expense');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                statusMessage.className = 'status-message error-message';
                statusMessage.textContent = 'âŒ Error: ' + error.message;
            });
        }

        // Load statistics for preview
        function loadStatistics() {
            fetch(API_URL + '/api/expenses')
                .then(response => response.json())
                .then(expenses => {
                    if (!expenses || expenses.length === 0) {
                        return;
                    }

                    const today = new Date().toISOString().split('T')[0];
                    const currentMonth = new Date().toISOString().substring(0, 7);

                    let todayTotal = 0;
                    let monthTotal = 0;

                    expenses.forEach(expense => {
                        if (expense.date === today) {
                            todayTotal += expense.amount;
                        }
                        if (expense.date.startsWith(currentMonth)) {
                            monthTotal += expense.amount;
                        }
                    });

                    document.getElementById('todayTotal').textContent = 'AED ' + todayTotal.toFixed(2);
                    document.getElementById('monthTotal').textContent = 'AED ' + monthTotal.toFixed(2);
                })
                .catch(error => {
                    console.error('Error loading statistics:', error);
                });
        }
    </script>
</body>
</html>
