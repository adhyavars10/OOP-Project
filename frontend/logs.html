<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìã Application Logs - Finance Tracker</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="nav-container">
            <h1 class="logo">üí∞ Finance Tracker</h1>
            <ul class="nav-links">
                <li><a href="index.html">Dashboard</a></li>
                <li><a href="add-expense.html">Add Expense</a></li>
                <li><a href="add-income.html">Add Income</a></li>
                <li><a href="expenses.html">View Expenses</a></li>
                <li><a href="income.html">View Income</a></li>
                <li><a href="logs.html" class="active">Logs</a></li>
            </ul>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container">
        <div class="page-header">
            <h2>üìã Application Logs</h2>
            <p>View system logs and track application activity</p>
        </div>

        <!-- Log Info Card -->
        <div class="info-card">
            <h4></h4>‚ÑπÔ∏è About Logs</h4>
            <p>This page displays real-time application logs from the backend server. Logs include:</p>
            <ul>
                <li>Database connection events</li>
                <li>Transaction additions (expenses and income)</li>
                <li>Delete operations</li>
                <li>Error messages and exceptions</li>
                <li>System initialization events</li>
            </ul>
        </div>

        <!-- Actions Bar -->
        <div class="actions-bar">
            <button onclick="loadLogs()" class="btn btn-primary">üîÑ Refresh Logs</button>
            <button onclick="clearDisplay()" class="btn btn-secondary">üóëÔ∏è Clear Display</button>
        </div>

        <!-- Logs Display Section -->
        <div class="section-card">
            <h3>üìù Log Output</h3>
            <div class="log-container">
                <pre id="logContent" class="log-output">Loading logs from server...</pre>
            </div>
        </div>

        <!-- Log Statistics -->
        <div class="section-card">
            <h3>üìä Log Statistics</h3>
            <div class="quick-stats">
                <div class="stat-item">
                    <span class="stat-label">Total Lines:</span>
                    <span class="stat-value" id="totalLines">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Error Count:</span>
                    <span class="stat-value" id="errorCount">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Last Updated:</span>
                    <span class="stat-value" id="lastUpdated">Never</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <p>Finance Tracker - OOP Project | BITS Pilani</p>
        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1); font-size: 0.9em;">
            <p style="margin: 5px 0;"><strong>OOP Group Project - 2025-2026</strong></p>
            <p style="margin: 5px 0;"><strong>Team Members:</strong></p>
            <p style="margin: 3px 0;">Harshwardhan Mohadikar - 2024ADPS0004U</p>
            <p style="margin: 3px 0;">Adhya Varshney - 2024A7PS0197U</p>
            <p style="margin: 3px 0;">Daksh Dawra - 2024A7PS0264U</p>
            <p style="margin: 3px 0;">Anirudh Jain - 2024A7PS0171U</p>
            <p style="margin: 3px 0;">Anish Malhotra - 2024A7PS0226U</p>
            <p style="margin: 3px 0;">Vardhaman Jain - 2024A7PS0229U</p>
        </div>
    </footer>

    <script>
        // CHANGE THIS to your Render.com backend URL
        const API_URL = 'http://localhost:8080';

        // Load logs on page load
        window.addEventListener('DOMContentLoaded', function() {
            loadLogs();
        });

        // Function to load logs from server
        function loadLogs() {
            const logContent = document.getElementById('logContent');
            logContent.textContent = 'Loading logs from server...';

            fetch(API_URL + '/api/logs')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to fetch logs');
                    }
                    return response.text();
                })
                .then(logs => {
                    if (!logs || logs.trim() === '') {
                        logContent.textContent = 'No logs available yet. The application will start logging once operations are performed.';
                        updateStatistics('', 0);
                        return;
                    }

                    // Display logs
                    logContent.textContent = logs;

                    // Count error lines
                    const errorCount = (logs.match(/ERROR/g) || []).length;
                    updateStatistics(logs, errorCount);

                    // Auto-scroll to bottom
                    logContent.scrollTop = logContent.scrollHeight;
                })
                .catch(error => {
                    console.error('Error loading logs:', error);
                    logContent.textContent = 'Error loading logs: ' + error.message + '\n\nPlease ensure the backend server is running and accessible.';
                    updateStatistics('', 0);
                });
        }

        // Function to update log statistics
        function updateStatistics(logs, errorCount) {
            const lines = logs.split('\n').filter(line => line.trim() !== '').length;
            const now = new Date().toLocaleString();

            document.getElementById('totalLines').textContent = lines;
            document.getElementById('errorCount').textContent = errorCount;
            document.getElementById('lastUpdated').textContent = now;
        }

        // Function to clear display (client-side only)
        function clearDisplay() {
            if (confirm('This will only clear the display. Server logs remain unchanged. Continue?')) {
                document.getElementById('logContent').textContent = 'Display cleared. Click "Refresh Logs" to reload from server.';
                document.getElementById('totalLines').textContent = '0';
                document.getElementById('errorCount').textContent = '0';
            }
        }

        // Auto-refresh logs every 30 seconds
        setInterval(function() {
            loadLogs();
        }, 30000);
    </script>
</body>
</html>
